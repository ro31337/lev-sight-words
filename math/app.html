<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Math for kids</title>

  <style>
    #xx-math {
      display: block;
      max-width: 920px;
      margin: 0 auto !important;
    }

    #xx-blocker .content {
      font-family: Arial;
      background-color: #f0f0f0;
      color: #333;
      font-size: 80px;

      display: flex;
      flex-direction: row;
      flex-wrap: no-wrap;
      justify-content: space-evenly;
    }

    #xx-blocker .content .one,
    #xx-blocker .content .two,
    #xx-blocker .content .three {
      display: flex;
      flex-direction: column;
      background-color: #d0d0d0;
      text-align: center;
    }

    #xx-blocker .content .one .hint,
    #xx-blocker .content .two .hint,
    #xx-blocker .content .three .hint {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      background-color: #e0e0e0;
      justify-content: flex-start;
    }
    #xx-blocker .content .one,
    #xx-blocker .content .two,
    #xx-blocker .content .three {
      flex-grow: 1;
      max-width: 300px;
    }
    #xx-blocker .content .one .element,
    #xx-blocker .content .two .element,
    #xx-blocker .content .three .element {
      width: calc(20% - 10px);
    }

    #xx-blocker .element {
      width: 20px;
      height: 20px;
      border-radius: 20px;
      transition: left 2s linear, top 2s linear;
      opacity: 0.01; /* change to 0.01 or to 0.4 */
      border: solid 4px #f0f0f0;
    }

    #xx-blocker .element.first {
      background-color: #c08a6c;
    }
    #xx-blocker .element.second {
      background-color: #9b5c3f;
    }
  </style>

  <script>
    function f() {
      const elements = document.querySelectorAll('div[data-shadow-id]');
      for (var i = 0, len = elements.length; i < len; i++) {
        const element = elements.item(i);
        const id = element.getAttribute('data-shadow-id');
        const placeholder = document.querySelector(`div[data-placeholder-id="${id}"]`);

        const rect = placeholder.getBoundingClientRect();
        const offsets = {
          left: rect.left + window.scrollX,
          top: rect.top + window.scrollY,
        };

        element.style.cssText = `position: absolute; top: ${offsets.top}px; left: ${offsets.left}px; opacity: 1;`;
      }
    };

    function createShadows() {
      const elements = document.querySelectorAll('div[data-element-id]');
      const content = document.getElementById('content');

      for (var i = 0, len = elements.length; i < len; i++) {
        //alert(elements.item(i));
        const element = elements.item(i);
        const rect = element.getBoundingClientRect();
        const offsets = {
          left: rect.left + window.scrollX,
          top: rect.top + window.scrollY,
        };

        const id = element.getAttribute('data-element-id');

        const shadowElement = document.createElement('div');
        shadowElement.classList = element.classList;
        shadowElement.style.cssText = `position: absolute; top: ${offsets.top}px; left: ${offsets.left}px; opacity: 1;`;
        content.appendChild(shadowElement);

        shadowElement.setAttribute('data-shadow-id', id);
      }
    }

    /**
     * Returns a random integer between min (inclusive) and max (inclusive).
     * The value is no lower than min (or the next integer greater than min
     * if min isn't an integer) and no greater than max (or the next integer
     * lower than max if max isn't an integer).
     * Using Math.round() will give you a non-uniform distribution!
     */
    const getRandomInt = (min, max) => {
      min = Math.ceil(min);
      max = Math.floor(max);
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    const initMath = () => {
      const x = getRandomInt(0, 9);
      const y = getRandomInt(0, 10 - x);
      const sum = x + y;

      // Below we use tricky construction so we have natural sequence 1 2 3 4 5 6 7 8 9 10
      // when x is 8 and y is 2, and 3 4 5 6 7 8 9 10 1 2 sequence when x is 2 and y is 8.
      // It makes animations much more easier to understand.
      //
      //    > x = 2
      //      2
      //    > y = 8
      //      8
      //    > Array(sum).fill().map((_, i) => y > x ? ((i + x + 1) % sum === 0 ? 10 : (i + x + 1) % sum) : i + 1).join(' ')
      //      '3 4 5 6 7 8 9 10 1 2'
      //    > x = 8
      //      8
      //    > y = 2
      //      2
      //    > Array(sum).fill().map((_, i) => y > x ? ((i + x + 1) % sum === 0 ? 10 : (i + x + 1) % sum) : i + 1).join(' ')
      //      '1 2 3 4 5 6 7 8 9 10'
      //

      const html = `
        <div id="content" class="content">
          <div class="one">
            <div class="value">${x}</div>
            <div class="hint">
              ${Array(x).fill().map((_, i) => `<div class="element first" data-element-id="${i + 1}"></div>`).join('')}
            </div>
          </div>
          <div class="plus">+</div>
          <div class="two">
            <div class="value">${y}</div>
            <div class="hint">
              ${Array(y).fill().map((_, i) => `<div class="element second" data-element-id="${x + i + 1}"></div>`).join('')}
            </div>
          </div>
          <div class="makes">=</div>
          <div class="three">
            <div class="value">${sum}</div>
            <div class="hint">
              ${Array(sum).fill().map((_, i) => `<div class="element" data-placeholder-id="${y > x ? ((i + x + 1) % sum === 0 ? sum : (i + x + 1) % sum) : i + 1}"></div>`).join('')}
            </div>
          </div>
        </div>
        <button onclick="f()">click me</button>
      `;

      const target = document.getElementById('xx-blocker');

      const div = document.createElement("div");
      div.id = 'xx-math';
      div.innerHTML = html;
      target.appendChild(div);

      setTimeout(createShadows, 1000);
    }

    document.addEventListener("DOMContentLoaded", function () {
      initMath();
    });
  </script>
</head>

<body>
  <div id="xx-blocker"></div>
</body>
</html>
